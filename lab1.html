

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Topics in Mathematical Biology &#8212; MAS377 Mathematical Biology</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lab1';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="11-12 Project Week" href="ch11.html" />
    <link rel="prev" title="9 - A within-host Covid model" href="ch9.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Topics in Mathematical Biology
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ch1.html">1 - Single population models</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch2.html">2 - Bifurcations and introducing competition</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch3.html">3 - Competition continued</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch4.html">4 - Predator-Prey models</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch5.html">5 - Epidemics in human populations</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch6.html">6 - The SIR model with demographics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch7.html">7 - Vaccination and disease in the wild</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch8.html">8 - Adaptive dynamics</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch9.html">9 - A within-host Covid model <a name="chapter8"></a></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Topics in Mathematical Biology</a></li>






<li class="toctree-l1"><a class="reference internal" href="ch11.html">11-12 Project Week</a></li>

<li class="toctree-l1"><a class="reference internal" href="ch13.html">13 - A within-host HIV model <a name="chapter9"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch14.html">14 - A model of cancer growth <a name="chapter13"></a></a></li>
<li class="toctree-l1"><a class="reference internal" href="ch15.html">15 - Introducing gene models</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch16.html">16 - Oscillating transcription and autoregulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch18.html">17 - More modelling of an autoregulation gene</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch17.html">18 - Computer lab</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch19.html">19 - Longer negative feedback circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch20.html">20 - A two gene toggle switch</a></li>
<li class="toctree-l1"><a class="reference internal" href="level4.html">4th year information</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/abestshef/mas377/blob/master/lab1.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/abestshef/mas377" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/abestshef/mas377/issues/new?title=Issue%20on%20page%20%2Flab1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/lab1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Topics in Mathematical Biology</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Topics in Mathematical Biology</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computer-lab-1">Computer lab 1</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting started</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-epidemic-model">1 - A first epidemic model#</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-best-control-an-epidemic">2 - How to best control an epidemic</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#control-with-different-risk-groups">3 - Control with different risk groups</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#including-randomness-in-our-model">3: Including randomness in our model#</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#a-bit-extra-in-case-we-still-have-time">5 - A bit extra in case we still have time…</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-does-this-tell-us">What does this tell us?</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="topics-in-mathematical-biology">
<h1>Topics in Mathematical Biology<a class="headerlink" href="#topics-in-mathematical-biology" title="Permalink to this heading">#</a></h1>
<section id="computer-lab-1">
<h2>Computer lab 1<a class="headerlink" href="#computer-lab-1" title="Permalink to this heading">#</a></h2>
<p><em><strong>You cannot edit this workbook. You need to go to File / Save a copy in Drive first.</strong></em></p>
<p>In this lab you will see how we can use scientific computing approaches to gain further insight into problems in mathematical biology. This lab will focus on epidemic models.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this heading">#</a></h1>
<p>For those of you who have never coded in python before, it might be useful to see a few useful features (hopefully you have watched the video on Blackboard as well).</p>
<p>Firstly, we can get python to output (or print) things to the screen. If we want it to say a specific phrase we put that in speech marks. If we want it to print out the value of some parameter or variable, we just write the name of the variable. Try typing the following few lines into the cell below this one (you won’t be able to just copy and paste these - you need to type them out!).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&quot;Hello World&quot;)
x=17
print(x)
y=[1,1,2,3,5,8,13,21,34,55,89]
print(&quot;The 10th number in the Fibonacci sequence is&quot;, y[9])
</pre></div>
</div>
<p>(Notice that to get the 10th number in the list called y, we refer to y[9]. That is because python starts counting from 0.)</p>
<p>Then either click the icon that looks like a Play button, or hit Shift-Enter. You should then see the phrase printed out just below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE GOES HERE</span>
</pre></div>
</div>
</div>
</div>
<p>Well done - you’ve done your first coding!!</p>
<p>Let’s try something a bit more advanced. A real advantage of coding in science and maths is using <em>loops</em>. This means we can do a large set of calculations with just a few lines of code. Let’s do this to calculate the first 10 square numbers. Type the following into the next code box:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for i in range(11):
    print(&quot;The square of&quot;, i, &quot;is&quot;, i**2)
</pre></div>
</div>
<p>(You will notice when you hit return after the colon the line automatically indents. This is important - you must leave the indent there for Python to understand the code). You can hopefully appreciate that this means we can carry out lots of calculations using programming in a quick and efficient way.</p>
<p>If you feel like a general coding challenge, see if you can write code to produce the first N numbers in the Fibonacci sequence, like you did above, but now using a loop rather than having to write them all out yourself.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOUR CODE GOES HERE</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="a-first-epidemic-model">
<h1>1 - A first epidemic model#<a class="headerlink" href="#a-first-epidemic-model" title="Permalink to this heading">#</a></h1>
<p>First we shall write code for our first epidemic model given by the following ODEs,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{eqnarray*}
\frac{dS}{dt} &amp;= -\beta SI\\
\frac{dI}{dt} &amp;= \beta SI - \gamma I\\
\frac{dR}{dt} &amp;= \gamma I.
\end{eqnarray*}\]</div>
<p>The parameter <span class="math notranslate nohighlight">\(\beta\)</span> controls how infectious the virus is, and <span class="math notranslate nohighlight">\(\gamma\)</span> controls how quickly infected individuals clear the virus. Remember that since the population size is constant we do not need to actively follow <span class="math notranslate nohighlight">\(dR/dt\)</span> (though we can if we really want to).</p>
<p>The video on Blackboard showed you how to build up a very similar model. Here I have provided working code for you. Again, you can run it either by clicking in the cell and hitting Shift-Enter or by clicking on the ‘Play’ icon.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#These are the modules we need to run some of our commands</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="c1"># These make the plots look nicer</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

<span class="c1"># This function contains our ODEs</span>
<span class="k">def</span> <span class="nf">disease</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="n">sdot</span><span class="o">=-</span><span class="n">BETA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">idot</span><span class="o">=</span><span class="n">BETA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sdot</span><span class="p">,</span> <span class="n">idot</span>

<span class="c1"># We need to choose values for all of our model parameters</span>
<span class="n">N0</span><span class="o">=</span><span class="mi">500000</span>         <span class="c1"># Total population size</span>
<span class="n">GAMMA</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">14</span>        <span class="c1"># Recovery rate (1/14 means it takes 14 days for hosts to recover)</span>
<span class="n">R0</span><span class="o">=</span><span class="mf">0.7</span>              <span class="c1"># I will decide on an R0, then use that to calculate what the transmission must be</span>
<span class="n">BETA</span><span class="o">=</span><span class="n">R0</span><span class="o">*</span><span class="n">GAMMA</span><span class="o">/</span><span class="n">N0</span>  <span class="c1"># Transmission</span>

<span class="c1"># Now we specify time-points to run the model for and initial conditions for S0 and I0</span>
<span class="n">ts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">3601</span><span class="p">)</span>
<span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="n">N0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># The magic happens when we send it all to the solve_ivp function</span>
<span class="n">xsol</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">x0</span><span class="p">,</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">)</span>

<span class="c1"># And now we plot the output</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Susceptible&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Infected&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">N0</span><span class="o">-</span><span class="p">(</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recovered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Densities&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#To save your figure delete the &#39;#&#39; in the front of the line below. To find the saved file, click on the folder icon in the left-hand column of the screen.</span>
<span class="c1">#plt.savefig(&#39;myfigure1.png&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Susceptible&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Infected&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">250000</span><span class="p">,</span><span class="mi">500000</span><span class="p">])</span> <span class="c1"># This line is there to stop the x axis getting too messy</span>
<span class="c1">#To save your figure delete the &#39;#&#39; in the front of the line below. To find the saved file, click on the folder icon in the left-hand column of the screen.</span>
<span class="c1">#plt.savefig(&#39;myfigure2.png&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>([&lt;matplotlib.axis.XTick at 0x24dd9f55a10&gt;,
  &lt;matplotlib.axis.XTick at 0x24dd9f540d0&gt;,
  &lt;matplotlib.axis.XTick at 0x24dd7a7f490&gt;],
 [Text(0, 0, &#39;0&#39;), Text(250000, 0, &#39;250000&#39;), Text(500000, 0, &#39;500000&#39;)])
</pre></div>
</div>
<img alt="_images/2a5d4c77003d4e9021e6f900f9c8ada7c55b72b57ed53f6711cee465cc963d7f.png" src="_images/2a5d4c77003d4e9021e6f900f9c8ada7c55b72b57ed53f6711cee465cc963d7f.png" />
<img alt="_images/b735fc3e992b0326200e77e402ed19b2c360c7b3f1a5ba90340204a464dfc473.png" src="_images/b735fc3e992b0326200e77e402ed19b2c360c7b3f1a5ba90340204a464dfc473.png" />
</div>
</div>
<p>Examine the two plots. The first gives you a time course of the 3 densities, and the second shows  atrajectory in the phase space. Do they look how you’d expect? Try changing some parameter values, to a lower or high <span class="math notranslate nohighlight">\(R_0\)</span> for example. How do the plots change?</p>
<p>As well as these plots we can get pythong to tell us useful information. For example, we might ask what is the density of susceptible people at the end of the time-course? And what was the density of infected people at the peak? The next cell will get python will tell you these things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;After&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;days there are&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;susceptible individuals,&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;infected individuals and&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">N0</span><span class="o">-</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;recovered individuals&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;At the infection&#39;s peak there were&quot;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xsol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">2</span><span class="p">),</span><span class="s2">&quot;infected individuals.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>After 360.0 days there are 499996.67 susceptible individuals, 0.0 infected individuals and 3.33 recovered individuals
At the infection&#39;s peak there were 1.0 infected individuals.
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="how-to-best-control-an-epidemic">
<h1>2 - How to best control an epidemic<a class="headerlink" href="#how-to-best-control-an-epidemic" title="Permalink to this heading">#</a></h1>
<p>Let’s extend our model to ask a different question. This code has been set up so you just move a slider - you won’t do any of the coding.</p>
<p>A big question for communities and governments in the last few years has been how best to control the spread of infection through <em>non-pharmaceutical interventions</em> (NPIs) such as lockdowns, group size limits, mask-wearing, etc. In the next bit of code you’ll be able to decide:</p>
<ul class="simple">
<li><p>The start day of the control</p></li>
<li><p>The length of the control</p></li>
<li><p>The effect of the control (through a percentage reduction in <span class="math notranslate nohighlight">\(R_0\)</span>).</p></li>
</ul>
<p>Click the play button again, then use the sliders to choose your values. You’ll see the plot update as you choose diferent values.</p>
<p>Let’s say you know a particular NPI can reduce <span class="math notranslate nohighlight">\(R_0\)</span> by 50% (so set ‘Effect’ to 50) but that you don’t want to implement it for more than 2 months (so set ‘Length’ to 60). What start day would you recommend for the control and why? Keeping the Effect at 50, can you find a combination of Start Day and Length that will keep the number of infections below 25,000 for the length of the simulation?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>

<span class="c1">#controlstartw=widgets.FloatSlider(min=5, max=100, step=5, value=50, description=&#39;Control start day&#39;)</span>
<span class="c1">#controllengthw=widgets.FloatSlider(min=0, max=150, step=10, value=100, description=&#39;Control length&#39;)</span>
<span class="c1">#controleffectw=widgets.FloatSlider(min=0, max=100, step=5, value=50, description=&#39;Control effect&#39;)</span>

<span class="k">def</span> <span class="nf">disease</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">BETA</span><span class="p">,</span><span class="n">GAMMA</span><span class="p">):</span>
    <span class="n">sdot</span><span class="o">=-</span><span class="n">BETA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">idot</span><span class="o">=</span><span class="n">BETA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sdot</span><span class="p">,</span> <span class="n">idot</span>

<span class="k">def</span> <span class="nf">basic_covid</span><span class="p">(</span><span class="n">controlstartw</span><span class="p">,</span><span class="n">controllengthw</span><span class="p">,</span><span class="n">controleffectw</span><span class="p">):</span>
  <span class="n">start_cont</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">controlstartw</span><span class="p">)</span>
  <span class="n">end_cont</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">start_cont</span><span class="o">+</span><span class="n">controllengthw</span><span class="p">)</span>

  <span class="n">N0</span><span class="o">=</span><span class="mi">500000</span>        <span class="c1"># Population size</span>
  <span class="n">gamma</span><span class="o">=</span><span class="mf">0.1</span>         <span class="c1"># Recovery rate</span>
  <span class="n">R0</span><span class="o">=</span><span class="mf">2.5</span>
  <span class="n">beta1</span><span class="o">=</span><span class="n">R0</span><span class="o">*</span><span class="n">gamma</span><span class="o">/</span><span class="n">N0</span>  <span class="c1"># Transmission</span>
  <span class="n">ts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">365</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
  <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="n">N0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">#Initial condition assuming population of 65 million with 1 infected</span>

  <span class="n">ta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_cont</span><span class="p">,</span> <span class="n">start_cont</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
  <span class="n">tb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_cont</span><span class="p">,</span><span class="n">end_cont</span><span class="p">,</span><span class="mi">600</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">end_cont</span><span class="o">&lt;</span><span class="mi">365</span><span class="p">:</span>
    <span class="n">tc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">end_cont</span><span class="p">,</span><span class="mi">365</span><span class="p">,(</span><span class="mi">365</span><span class="o">-</span><span class="n">end_cont</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">tc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">end_cont</span><span class="p">,</span><span class="n">end_cont</span><span class="o">+</span><span class="mf">0.001</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">xxa</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease</span><span class="p">,[</span><span class="n">ta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">x0</span><span class="p">,</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ta</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>
  <span class="n">xxb</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease</span><span class="p">,[</span><span class="n">tb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">xxa</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">xxa</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">t_eval</span><span class="o">=</span><span class="n">tb</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">((</span><span class="mi">100</span><span class="o">-</span><span class="n">controleffectw</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>
  <span class="n">xxc</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease</span><span class="p">,[</span><span class="n">tc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">tc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">xxb</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">xxb</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">t_eval</span><span class="o">=</span><span class="n">tc</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="c1">#</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

  <span class="n">fig1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
  <span class="n">xx1</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">x0</span><span class="p">,</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">xx1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;No control&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ta</span><span class="p">,(</span><span class="n">xxa</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tb</span><span class="p">,(</span><span class="n">xxb</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tc</span><span class="p">,(</span><span class="n">xxc</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;No. Infected individuals&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">150000</span><span class="p">])</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">interact</span><span class="p">(</span><span class="n">basic_covid</span><span class="p">,</span><span class="n">controlstartw</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Start day&#39;</span><span class="p">),</span><span class="n">controllengthw</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Length&#39;</span><span class="p">),</span><span class="n">controleffectw</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Effect&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "d51dd72c68b243169aea7abc98e64814"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.basic_covid(controlstartw, controllengthw, controleffectw)&gt;
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="control-with-different-risk-groups">
<h1>3 - Control with different risk groups<a class="headerlink" href="#control-with-different-risk-groups" title="Permalink to this heading">#</a></h1>
<p>The model above assumed that everyone in the population was subject to the same control measures. What if we were instead to target control measures only to thos emost vulnerable to the infection? In the next model we test out this idea (which was suggested by some as a possible strategy during the worst stages of Covid-19). We define 20% of the population to be high-risk and the rest as low-risk. We then test out 4 different strategies:</p>
<ol class="arabic simple">
<li><p>No control at all.</p></li>
<li><p>Full control of both groups.</p></li>
<li><p>Control only of the high-risk group.</p></li>
<li><p>Control only of the low-risk group.</p></li>
</ol>
<p>Here control again means reducing <span class="math notranslate nohighlight">\(R_0\)</span> by some percentage, with a default of <span class="math notranslate nohighlight">\(R_0=3\)</span>. We plot two things here - the total number of infections in the population and the number of infections in the high-risk group.</p>
<p>Choose a level of control and see what happens.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span>

<span class="k">def</span> <span class="nf">disease_risk</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">betall</span><span class="p">,</span><span class="n">betahh</span><span class="p">,</span><span class="n">betahl</span><span class="p">,</span><span class="n">gamma</span><span class="p">):</span>
    <span class="n">sldot</span><span class="o">=-</span><span class="n">betall</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">betahl</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">ildot</span><span class="o">=</span><span class="n">betall</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">betahl</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">gamma</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">shdot</span><span class="o">=-</span><span class="n">betahh</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">betahl</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ihdot</span><span class="o">=</span><span class="n">betahh</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">betahl</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">gamma</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sldot</span><span class="p">,</span> <span class="n">ildot</span><span class="p">,</span> <span class="n">shdot</span><span class="p">,</span> <span class="n">ihdot</span>

<span class="k">def</span> <span class="nf">riskmodel</span><span class="p">(</span><span class="n">controlw</span><span class="p">):</span>
  <span class="n">N0</span><span class="o">=</span><span class="mi">65000000</span>        <span class="c1"># Population size</span>
  <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">14</span>         <span class="c1"># Recovery rate</span>
  <span class="n">R0</span><span class="o">=</span><span class="mi">3</span>
  <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span> <span class="c1"># Use to make plots easier to understand</span>
  <span class="n">beta1</span><span class="o">=</span><span class="n">R0</span><span class="o">*</span><span class="n">gamma</span><span class="o">/</span><span class="n">N0</span>  <span class="c1"># Transmission</span>
  <span class="n">ts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">365</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span>
  <span class="n">x0</span><span class="o">=</span><span class="p">[</span><span class="n">N0</span><span class="o">*</span><span class="mf">0.8</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N0</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">#Initial condition</span>
  <span class="n">control</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">controlw</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span>

  <span class="n">xx1</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease_risk</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">x0</span><span class="p">,</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span><span class="n">beta1</span><span class="p">,</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>
  <span class="n">xx2</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease_risk</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">x0</span><span class="p">,</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">control</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">beta1</span><span class="p">,</span><span class="n">control</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>
  <span class="n">xx3</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease_risk</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">x0</span><span class="p">,</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">beta1</span><span class="p">,</span><span class="n">control</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">control</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>
  <span class="n">xx4</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease_risk</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">x0</span><span class="p">,</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">control</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">control</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">control</span><span class="o">*</span><span class="n">beta1</span><span class="p">,</span><span class="n">gamma</span><span class="p">,))</span>

  <span class="n">fig1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xx1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;No control&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx3</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xx3</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control in high-risk&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xx2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control in low-risk&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx4</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xx4</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">/</span><span class="n">scale</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control in all&#39;</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;No. Infected individuals (millions)&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>

  <span class="n">fig2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;No control&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx3</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">),</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control in high-risk&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control in low-risk&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx4</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Control in all&#39;</span><span class="p">)</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;No. high-risk Infected individuals (millions)&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
  <span class="k">return</span><span class="p">()</span>

<span class="n">interact</span><span class="p">(</span><span class="n">riskmodel</span><span class="p">,</span><span class="n">controlw</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Effect&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "4adb41f36b1b4970a7ac3af68bf1c9ad"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.riskmodel(controlw)&gt;
</pre></div>
</div>
</div>
</div>
<p>Perhaps you are surprised to see that while controlling only the high-risk group reduces both total and high-risk infections compared to no control, this strategy is actually much less effective than if we were to only control the low-risk group. This is just down to the weight of numbers. When there are so many low-risk individuals, even if there is a small amount of contact between low- and high-risk gorups, there can be significant amounts of infection. Therefore if we actually control the larger low-risk group, we can reduce the amount of infection, not just in the whole population but actually amongst the high-risk group specifically.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="including-randomness-in-our-model">
<h1>3: Including randomness in our model#<a class="headerlink" href="#including-randomness-in-our-model" title="Permalink to this heading">#</a></h1>
<p>The models we have looked at so far are examples of <em>deterministic</em> models. The key aspect of these is that if we use the same values for all our parameters and the same starting conditions, we will get the exact same results every time. They are therefore entirely predictable, hence the name “deterministic” (you may or may not be surprised to know that even chaotic systems are in fact deterministic). An alternative approach is a <em>stochastic</em> model. In this case we include randomness in our model, which leads to a different outcome every time we run our model.</p>
<p>The model below is the same as the very first model you ran, except the population size is reduced to 1000 to keep it running quickly. This time you need to click the button after you select your value of <span class="math notranslate nohighlight">\(R_0\)</span> to make the simulation run. As well as the deterministic model, it will now also produce 20 stochastic simuation runs. You will also see a red dot marking where the stochastic simulation says the infection dies out. You should see that you get a bit of variation between the 20 runs - for example in the height and timing of the peak and the point when the infection dies out - but that the deterministic model does ok as an average.</p>
<p>Do you get larger variation for a larger or smaller value of <span class="math notranslate nohighlight">\(R_0\)</span>? Try setting <span class="math notranslate nohighlight">\(R_0\)</span> to be 1.5 or 2 and run the simulations. Do you notice anything unusual?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>
<span class="c1"># Import the necessary libraries</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact_manual</span>
<span class="n">R0w</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;R_0&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_model1</span><span class="p">():</span>
  <span class="n">N</span><span class="o">=</span><span class="mi">1000</span>
  <span class="n">GAMMA</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span>
  <span class="n">R0</span><span class="o">=</span><span class="n">R0w</span><span class="o">.</span><span class="n">value</span>
  <span class="n">BETA</span><span class="o">=</span><span class="n">R0</span><span class="o">*</span><span class="n">GAMMA</span><span class="o">/</span><span class="n">N</span>
  <span class="n">REPS</span><span class="o">=</span><span class="mi">20</span>
  <span class="n">I0</span><span class="o">=</span><span class="mi">5</span>


  <span class="c1"># INDIVIDUAL-BASED MODEL</span>

  <span class="c1"># Function to count noumbers in each compartment</span>
  <span class="k">def</span> <span class="nf">count_type</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
      <span class="n">current_type</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
              <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="nb">type</span><span class="p">:</span>
                  <span class="n">current_type</span><span class="o">=</span><span class="n">current_type</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">return</span> <span class="n">current_type</span>

  <span class="c1"># Function to check the current scale</span>
  <span class="k">def</span> <span class="nf">findscale</span><span class="p">():</span>
      <span class="n">S</span><span class="o">=</span><span class="n">susceptibles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">I</span><span class="o">=</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="c1">#Set relative parameter values</span>
      <span class="n">scale</span><span class="o">=</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">I</span><span class="o">+</span><span class="n">BETA</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="n">I</span>
      <span class="k">return</span> <span class="n">scale</span>

  <span class="k">for</span> <span class="n">reps</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">REPS</span><span class="p">):</span>
      <span class="c1"># Set initial conditions</span>
      <span class="c1">#grid=np.zeros((N,N))</span>
      <span class="n">tsteps</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">infecteds</span><span class="o">=</span><span class="p">[</span><span class="n">I0</span><span class="p">]</span>
      <span class="n">susceptibles</span><span class="o">=</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">I0</span><span class="p">]</span>
      <span class="n">current_t</span><span class="o">=</span><span class="mi">0</span>

      <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span><span class="c1">#</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

      <span class="c1"># Main run</span>
      <span class="k">while</span> <span class="n">current_t</span><span class="o">&lt;</span><span class="mi">180</span><span class="p">:</span>
          <span class="c1"># Find tau-leap</span>
          <span class="n">scale</span><span class="o">=</span><span class="n">findscale</span><span class="p">()</span>
          <span class="n">dt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span> <span class="o">/</span> <span class="n">scale</span>
          <span class="n">current_t</span><span class="o">=</span><span class="n">tsteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
          <span class="n">tsteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">+</span><span class="n">current_t</span><span class="p">)</span>

          <span class="c1">#Find event</span>
          <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">&lt;</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">:</span> <span class="c1">#Event is recovery</span>
              <span class="n">infecteds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
              <span class="n">susceptibles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">susceptibles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
          <span class="k">else</span><span class="p">:</span> <span class="c1">#Event is transmission</span>
              <span class="n">infecteds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
              <span class="n">susceptibles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">susceptibles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

          <span class="k">if</span> <span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
              <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">tsteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
              <span class="k">break</span>

      <span class="c1"># Plot latest run</span>
      <span class="k">if</span> <span class="n">reps</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span><span class="n">infecteds</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stochastic model&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span><span class="n">infecteds</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>

  <span class="n">ts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>
  <span class="n">xx1</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="mi">995</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">BETA</span><span class="p">,</span><span class="n">GAMMA</span><span class="p">,))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,(</span><span class="n">xx1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Deterministic model&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span> <span class="p">(</span><span class="s1">&#39;No. Infected&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">600</span><span class="p">)</span>
  <span class="k">return</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">R0w</span><span class="p">)</span>
<span class="n">my_interact_manual3</span> <span class="o">=</span> <span class="n">interact_manual</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">manual_name</span><span class="o">=</span><span class="s2">&quot;Run model&quot;</span><span class="p">)</span>
<span class="n">my_interact_manual3</span><span class="p">(</span><span class="n">run_model1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "62011018ca76440a8b76357117dfa9a0"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "d13c395c68b043459d79409ef4ddb298"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.run_model1()&gt;
</pre></div>
</div>
</div>
</div>
<p><strong>Uncertainty</strong></p>
<p>One of the most important aspects of disease modelling, and in particular how we communicate our findings to the general public, is uncertainty. While we have produced these nice smooth, deterministic graphs, we know that in reality things will be more messy due to the complexisties of the real world and the effects of randomness. These stochastic models highlight how we might get different outcomes and that there is some balance of probabalities to think about. For example, for a smallish <span class="math notranslate nohighlight">\(R_0\)</span> we <em>might</em> get lucky and have an infection that dies out naturally but it is more likely the disease will spread.</p>
<p>#4 - Bells and whistles#</p>
<p>In this model we’ll look at something rather more complex. Let’s think about how an epidemic might spread within a small, closed population, for example on a university campus, and how different management strategies might affect an epidemic.  Underlying the whole thing is an SIR model of the types we’ve been looking at, but with the following additions:</p>
<ul class="simple">
<li><p>1000 people live in 100 households of 10.</p></li>
<li><p>Everyone is also assigned to a daily class lasting 2 hours. The default class size is 100.</p></li>
<li><p>Every week a proportion of the population test to see if they have the disease. The test is 95% accurate for positive cases and 99% accurate for negative cases. The default proportion of the population testing is 20%.</p></li>
<li><p>Anyone who tests positive isolates fully for a fixed number of days. The default isolation period is 3 days.</p></li>
<li><p>Contacts of anyone who has tested positive (taken randomly from their household and class) can also be told to isolate for the same isolation period. The default is that nobody is traced.</p></li>
</ul>
<p>Using the sliders you can decide what interventions you want to introduce to slow the spread. The simulation will show what happens in the default case and then what happens under your proposed controls.</p>
<p><em>This code is a fair bit slower than the previous examples so have patience!</em></p>
<p>What seems to be the best single intervention? What combination of measures might you suggest to a management committee wanting to limit the epidemic as far as possible without causing substantial disruption to the community?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact_manual</span>

<span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;initial&#39;</span><span class="p">}</span>
<span class="n">test_w</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;% Testing&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
<span class="n">isolate_w</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Days isolating&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
<span class="n">trace_w</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Max no. contacts&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
<span class="n">class_w</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Class size&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
<span class="n">mix_w</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;% Mixing reduction&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

<span class="c1">### Global constants</span>
<span class="k">def</span> <span class="nf">runmodel</span><span class="p">():</span>

    <span class="n">POPSIZE</span><span class="o">=</span><span class="mi">1000</span> <span class="c1"># Total individuals in population</span>
    <span class="n">NOHOUSES</span><span class="o">=</span><span class="mi">100</span> <span class="c1"># No. of households (mean household size = POPSIZE / NOHOUSES)</span>

    <span class="n">OMEGA</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">7</span> <span class="c1"># Latent rate</span>
    <span class="n">GAMMA</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">7</span> <span class="c1"># Recovery rate</span>
    <span class="n">WANE</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># Waning immunity rate</span>
    <span class="n">ISOLATE</span><span class="o">=</span><span class="mi">5</span>
    <span class="n">BETA</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">BETA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">0.02</span> <span class="c1"># Transmission coefficient at home</span>
    <span class="n">BETA</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mf">0.02</span> <span class="c1"># Transmission coefficient at class</span>
    <span class="c1">#BETASS=0.02</span>

    <span class="n">REPS</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># No. of replicate runs</span>
    <span class="n">I0</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># Initial no. of infected individuals (mean)</span>
    <span class="n">MAX_TIME</span><span class="o">=</span><span class="mi">150</span> <span class="c1"># Max time</span>
    <span class="n">CLASS_START</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># Time in day when move to class</span>
    <span class="n">CLASS_END</span> <span class="o">=</span> <span class="mf">0.48333</span> <span class="c1"># Time in day when move to house</span>

    <span class="n">statstore</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

    <span class="n">solstore</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">150</span><span class="p">))</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">47.0</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="mf">59.0</span><span class="p">,</span> <span class="mf">61.0</span><span class="p">,</span> <span class="mf">69.0</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">,</span> <span class="mf">73.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mf">87.0</span><span class="p">,</span> <span class="mf">93.0</span><span class="p">,</span> <span class="mf">110.0</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">,</span> <span class="mf">133.0</span><span class="p">,</span> <span class="mf">141.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">157.0</span><span class="p">,</span> <span class="mf">166.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">187.0</span><span class="p">,</span> <span class="mf">201.0</span><span class="p">,</span> <span class="mf">194.0</span><span class="p">,</span> <span class="mf">197.0</span><span class="p">,</span> <span class="mf">205.0</span><span class="p">,</span> <span class="mf">204.0</span><span class="p">,</span> <span class="mf">194.0</span><span class="p">,</span> <span class="mf">199.0</span><span class="p">,</span> <span class="mf">193.0</span><span class="p">,</span> <span class="mf">181.0</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">176.0</span><span class="p">,</span> <span class="mf">162.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">146.0</span><span class="p">,</span> <span class="mf">139.0</span><span class="p">,</span> <span class="mf">131.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">,</span> <span class="mf">108.0</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">,</span> <span class="mf">92.0</span><span class="p">,</span> <span class="mf">85.0</span><span class="p">,</span> <span class="mf">81.0</span><span class="p">,</span> <span class="mf">78.0</span><span class="p">,</span> <span class="mf">74.0</span><span class="p">,</span> <span class="mf">74.0</span><span class="p">,</span> <span class="mf">68.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">48.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">41.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">32.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">43.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">56.0</span><span class="p">,</span> <span class="mf">59.0</span><span class="p">,</span> <span class="mf">71.0</span><span class="p">,</span> <span class="mf">88.0</span><span class="p">,</span> <span class="mf">94.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">110.0</span><span class="p">,</span> <span class="mf">113.0</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">,</span> <span class="mf">122.0</span><span class="p">,</span> <span class="mf">133.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">154.0</span><span class="p">,</span> <span class="mf">157.0</span><span class="p">,</span> <span class="mf">157.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">161.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">159.0</span><span class="p">,</span> <span class="mf">162.0</span><span class="p">,</span> <span class="mf">158.0</span><span class="p">,</span> <span class="mf">160.0</span><span class="p">,</span> <span class="mf">160.0</span><span class="p">,</span> <span class="mf">147.0</span><span class="p">,</span> <span class="mf">140.0</span><span class="p">,</span> <span class="mf">139.0</span><span class="p">,</span> <span class="mf">135.0</span><span class="p">,</span> <span class="mf">131.0</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">,</span> <span class="mf">119.0</span><span class="p">,</span> <span class="mf">115.0</span><span class="p">,</span> <span class="mf">110.0</span><span class="p">,</span> <span class="mf">107.0</span><span class="p">,</span> <span class="mf">102.0</span><span class="p">,</span> <span class="mf">93.0</span><span class="p">,</span> <span class="mf">88.0</span><span class="p">,</span> <span class="mf">84.0</span><span class="p">,</span> <span class="mf">74.0</span><span class="p">,</span> <span class="mf">76.0</span><span class="p">,</span> <span class="mf">74.0</span><span class="p">,</span> <span class="mf">68.0</span><span class="p">,</span> <span class="mf">63.0</span><span class="p">,</span> <span class="mf">59.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">44.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">56.0</span><span class="p">,</span> <span class="mf">58.0</span><span class="p">,</span> <span class="mf">62.0</span><span class="p">,</span> <span class="mf">71.0</span><span class="p">,</span> <span class="mf">71.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="mf">88.0</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">,</span> <span class="mf">104.0</span><span class="p">,</span> <span class="mf">114.0</span><span class="p">,</span> <span class="mf">113.0</span><span class="p">,</span> <span class="mf">122.0</span><span class="p">,</span> <span class="mf">128.0</span><span class="p">,</span> <span class="mf">146.0</span><span class="p">,</span> <span class="mf">154.0</span><span class="p">,</span> <span class="mf">167.0</span><span class="p">,</span> <span class="mf">173.0</span><span class="p">,</span> <span class="mf">172.0</span><span class="p">,</span> <span class="mf">163.0</span><span class="p">,</span> <span class="mf">181.0</span><span class="p">,</span> <span class="mf">173.0</span><span class="p">,</span> <span class="mf">174.0</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">174.0</span><span class="p">,</span> <span class="mf">171.0</span><span class="p">,</span> <span class="mf">165.0</span><span class="p">,</span> <span class="mf">161.0</span><span class="p">,</span> <span class="mf">158.0</span><span class="p">,</span> <span class="mf">148.0</span><span class="p">,</span> <span class="mf">140.0</span><span class="p">,</span> <span class="mf">127.0</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">,</span> <span class="mf">130.0</span><span class="p">,</span> <span class="mf">118.0</span><span class="p">,</span> <span class="mf">113.0</span><span class="p">,</span> <span class="mf">103.0</span><span class="p">,</span> <span class="mf">99.0</span><span class="p">,</span> <span class="mf">91.0</span><span class="p">,</span> <span class="mf">84.0</span><span class="p">,</span> <span class="mf">81.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">,</span> <span class="mf">66.0</span><span class="p">,</span> <span class="mf">62.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mf">59.0</span><span class="p">,</span> <span class="mf">53.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">32.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">22.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">,</span> <span class="mf">57.0</span><span class="p">,</span> <span class="mf">59.0</span><span class="p">,</span> <span class="mf">64.0</span><span class="p">,</span> <span class="mf">73.0</span><span class="p">,</span> <span class="mf">85.0</span><span class="p">,</span> <span class="mf">92.0</span><span class="p">,</span> <span class="mf">92.0</span><span class="p">,</span> <span class="mf">92.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">117.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">,</span> <span class="mf">124.0</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">,</span> <span class="mf">133.0</span><span class="p">,</span> <span class="mf">155.0</span><span class="p">,</span> <span class="mf">165.0</span><span class="p">,</span> <span class="mf">181.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">,</span> <span class="mf">179.0</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">166.0</span><span class="p">,</span> <span class="mf">167.0</span><span class="p">,</span> <span class="mf">179.0</span><span class="p">,</span> <span class="mf">174.0</span><span class="p">,</span> <span class="mf">161.0</span><span class="p">,</span> <span class="mf">160.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">148.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">144.0</span><span class="p">,</span> <span class="mf">131.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">,</span> <span class="mf">118.0</span><span class="p">,</span> <span class="mf">118.0</span><span class="p">,</span> <span class="mf">108.0</span><span class="p">,</span> <span class="mf">102.0</span><span class="p">,</span> <span class="mf">92.0</span><span class="p">,</span> <span class="mf">89.0</span><span class="p">,</span> <span class="mf">88.0</span><span class="p">,</span> <span class="mf">81.0</span><span class="p">,</span> <span class="mf">76.0</span><span class="p">,</span> <span class="mf">68.0</span><span class="p">,</span> <span class="mf">63.0</span><span class="p">,</span> <span class="mf">58.0</span><span class="p">,</span> <span class="mf">54.0</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">22.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">,</span> <span class="mf">52.0</span><span class="p">,</span> <span class="mf">67.0</span><span class="p">,</span> <span class="mf">78.0</span><span class="p">,</span> <span class="mf">82.0</span><span class="p">,</span> <span class="mf">91.0</span><span class="p">,</span> <span class="mf">91.0</span><span class="p">,</span> <span class="mf">109.0</span><span class="p">,</span> <span class="mf">116.0</span><span class="p">,</span> <span class="mf">122.0</span><span class="p">,</span> <span class="mf">125.0</span><span class="p">,</span> <span class="mf">137.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">161.0</span><span class="p">,</span> <span class="mf">165.0</span><span class="p">,</span> <span class="mf">172.0</span><span class="p">,</span> <span class="mf">178.0</span><span class="p">,</span> <span class="mf">185.0</span><span class="p">,</span> <span class="mf">184.0</span><span class="p">,</span> <span class="mf">192.0</span><span class="p">,</span> <span class="mf">197.0</span><span class="p">,</span> <span class="mf">191.0</span><span class="p">,</span> <span class="mf">189.0</span><span class="p">,</span> <span class="mf">186.0</span><span class="p">,</span> <span class="mf">169.0</span><span class="p">,</span> <span class="mf">159.0</span><span class="p">,</span> <span class="mf">153.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mf">139.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">141.0</span><span class="p">,</span> <span class="mf">130.0</span><span class="p">,</span> <span class="mf">119.0</span><span class="p">,</span> <span class="mf">108.0</span><span class="p">,</span> <span class="mf">95.0</span><span class="p">,</span> <span class="mf">84.0</span><span class="p">,</span> <span class="mf">82.0</span><span class="p">,</span> <span class="mf">81.0</span><span class="p">,</span> <span class="mf">72.0</span><span class="p">,</span> <span class="mf">68.0</span><span class="p">,</span> <span class="mf">62.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mf">58.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">43.0</span><span class="p">,</span> <span class="mf">43.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">43.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">,</span> <span class="mf">77.0</span><span class="p">,</span> <span class="mf">85.0</span><span class="p">,</span> <span class="mf">83.0</span><span class="p">,</span> <span class="mf">98.0</span><span class="p">,</span> <span class="mf">98.0</span><span class="p">,</span> <span class="mf">104.0</span><span class="p">,</span> <span class="mf">104.0</span><span class="p">,</span> <span class="mf">114.0</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">,</span> <span class="mf">136.0</span><span class="p">,</span> <span class="mf">139.0</span><span class="p">,</span> <span class="mf">129.0</span><span class="p">,</span> <span class="mf">138.0</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">146.0</span><span class="p">,</span> <span class="mf">142.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">142.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mf">140.0</span><span class="p">,</span> <span class="mf">135.0</span><span class="p">,</span> <span class="mf">131.0</span><span class="p">,</span> <span class="mf">121.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">,</span> <span class="mf">119.0</span><span class="p">,</span> <span class="mf">105.0</span><span class="p">,</span> <span class="mf">89.0</span><span class="p">,</span> <span class="mf">86.0</span><span class="p">,</span> <span class="mf">87.0</span><span class="p">,</span> <span class="mf">83.0</span><span class="p">,</span> <span class="mf">85.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="mf">74.0</span><span class="p">,</span> <span class="mf">67.0</span><span class="p">,</span> <span class="mf">72.0</span><span class="p">,</span> <span class="mf">69.0</span><span class="p">,</span> <span class="mf">66.0</span><span class="p">,</span> <span class="mf">56.0</span><span class="p">,</span> <span class="mf">55.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">22.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">22.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">48.0</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="mf">54.0</span><span class="p">,</span> <span class="mf">59.0</span><span class="p">,</span> <span class="mf">67.0</span><span class="p">,</span> <span class="mf">69.0</span><span class="p">,</span> <span class="mf">85.0</span><span class="p">,</span> <span class="mf">93.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">92.0</span><span class="p">,</span> <span class="mf">104.0</span><span class="p">,</span> <span class="mf">118.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">,</span> <span class="mf">126.0</span><span class="p">,</span> <span class="mf">129.0</span><span class="p">,</span> <span class="mf">138.0</span><span class="p">,</span> <span class="mf">144.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">160.0</span><span class="p">,</span> <span class="mf">165.0</span><span class="p">,</span> <span class="mf">165.0</span><span class="p">,</span> <span class="mf">154.0</span><span class="p">,</span> <span class="mf">156.0</span><span class="p">,</span> <span class="mf">153.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">162.0</span><span class="p">,</span> <span class="mf">158.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">137.0</span><span class="p">,</span> <span class="mf">132.0</span><span class="p">,</span> <span class="mf">130.0</span><span class="p">,</span> <span class="mf">127.0</span><span class="p">,</span> <span class="mf">126.0</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">,</span> <span class="mf">118.0</span><span class="p">,</span> <span class="mf">121.0</span><span class="p">,</span> <span class="mf">120.0</span><span class="p">,</span> <span class="mf">115.0</span><span class="p">,</span> <span class="mf">104.0</span><span class="p">,</span> <span class="mf">95.0</span><span class="p">,</span> <span class="mf">88.0</span><span class="p">,</span> <span class="mf">77.0</span><span class="p">,</span> <span class="mf">72.0</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">,</span> <span class="mf">65.0</span><span class="p">,</span> <span class="mf">64.0</span><span class="p">,</span> <span class="mf">65.0</span><span class="p">,</span> <span class="mf">63.0</span><span class="p">,</span> <span class="mf">65.0</span><span class="p">,</span> <span class="mf">61.0</span><span class="p">,</span> <span class="mf">57.0</span><span class="p">,</span> <span class="mf">58.0</span><span class="p">,</span> <span class="mf">52.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">,</span> <span class="mf">48.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">42.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">48.0</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="mf">54.0</span><span class="p">,</span> <span class="mf">57.0</span><span class="p">,</span> <span class="mf">67.0</span><span class="p">,</span> <span class="mf">74.0</span><span class="p">,</span> <span class="mf">72.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="mf">89.0</span><span class="p">,</span> <span class="mf">101.0</span><span class="p">,</span> <span class="mf">111.0</span><span class="p">,</span> <span class="mf">112.0</span><span class="p">,</span> <span class="mf">118.0</span><span class="p">,</span> <span class="mf">135.0</span><span class="p">,</span> <span class="mf">136.0</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mf">154.0</span><span class="p">,</span> <span class="mf">158.0</span><span class="p">,</span> <span class="mf">168.0</span><span class="p">,</span> <span class="mf">172.0</span><span class="p">,</span> <span class="mf">179.0</span><span class="p">,</span> <span class="mf">174.0</span><span class="p">,</span> <span class="mf">184.0</span><span class="p">,</span> <span class="mf">188.0</span><span class="p">,</span> <span class="mf">178.0</span><span class="p">,</span> <span class="mf">164.0</span><span class="p">,</span> <span class="mf">165.0</span><span class="p">,</span> <span class="mf">154.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">149.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">135.0</span><span class="p">,</span> <span class="mf">134.0</span><span class="p">,</span> <span class="mf">132.0</span><span class="p">,</span> <span class="mf">128.0</span><span class="p">,</span> <span class="mf">119.0</span><span class="p">,</span> <span class="mf">110.0</span><span class="p">,</span> <span class="mf">108.0</span><span class="p">,</span> <span class="mf">102.0</span><span class="p">,</span> <span class="mf">91.0</span><span class="p">,</span> <span class="mf">84.0</span><span class="p">,</span> <span class="mf">82.0</span><span class="p">,</span> <span class="mf">79.0</span><span class="p">,</span> <span class="mf">72.0</span><span class="p">,</span> <span class="mf">65.0</span><span class="p">,</span> <span class="mf">58.0</span><span class="p">,</span> <span class="mf">57.0</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">23.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">22.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">39.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">45.0</span><span class="p">,</span> <span class="mf">49.0</span><span class="p">,</span> <span class="mf">69.0</span><span class="p">,</span> <span class="mf">71.0</span><span class="p">,</span> <span class="mf">76.0</span><span class="p">,</span> <span class="mf">80.0</span><span class="p">,</span> <span class="mf">91.0</span><span class="p">,</span> <span class="mf">98.0</span><span class="p">,</span> <span class="mf">118.0</span><span class="p">,</span> <span class="mf">130.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">136.0</span><span class="p">,</span> <span class="mf">133.0</span><span class="p">,</span> <span class="mf">137.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">155.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">,</span> <span class="mf">158.0</span><span class="p">,</span> <span class="mf">157.0</span><span class="p">,</span> <span class="mf">158.0</span><span class="p">,</span> <span class="mf">154.0</span><span class="p">,</span> <span class="mf">159.0</span><span class="p">,</span> <span class="mf">163.0</span><span class="p">,</span> <span class="mf">169.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">172.0</span><span class="p">,</span> <span class="mf">157.0</span><span class="p">,</span> <span class="mf">164.0</span><span class="p">,</span> <span class="mf">154.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">144.0</span><span class="p">,</span> <span class="mf">135.0</span><span class="p">,</span> <span class="mf">128.0</span><span class="p">,</span> <span class="mf">123.0</span><span class="p">,</span> <span class="mf">113.0</span><span class="p">,</span> <span class="mf">111.0</span><span class="p">,</span> <span class="mf">102.0</span><span class="p">,</span> <span class="mf">93.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">93.0</span><span class="p">,</span> <span class="mf">87.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mf">69.0</span><span class="p">,</span> <span class="mf">64.0</span><span class="p">,</span> <span class="mf">58.0</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="mf">47.0</span><span class="p">,</span> <span class="mf">41.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">33.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">28.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">17.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">solstore</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">24.0</span><span class="p">,</span> <span class="mf">29.0</span><span class="p">,</span> <span class="mf">32.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">34.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">41.0</span><span class="p">,</span> <span class="mf">41.0</span><span class="p">,</span> <span class="mf">51.0</span><span class="p">,</span> <span class="mf">55.0</span><span class="p">,</span> <span class="mf">63.0</span><span class="p">,</span> <span class="mf">68.0</span><span class="p">,</span> <span class="mf">77.0</span><span class="p">,</span> <span class="mf">85.0</span><span class="p">,</span> <span class="mf">97.0</span><span class="p">,</span> <span class="mf">97.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">107.0</span><span class="p">,</span> <span class="mf">114.0</span><span class="p">,</span> <span class="mf">127.0</span><span class="p">,</span> <span class="mf">133.0</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mf">143.0</span><span class="p">,</span> <span class="mf">153.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">162.0</span><span class="p">,</span> <span class="mf">171.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">,</span> <span class="mf">179.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">171.0</span><span class="p">,</span> <span class="mf">171.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">170.0</span><span class="p">,</span> <span class="mf">160.0</span><span class="p">,</span> <span class="mf">164.0</span><span class="p">,</span> <span class="mf">153.0</span><span class="p">,</span> <span class="mf">151.0</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">,</span> <span class="mf">134.0</span><span class="p">,</span> <span class="mf">131.0</span><span class="p">,</span> <span class="mf">132.0</span><span class="p">,</span> <span class="mf">124.0</span><span class="p">,</span> <span class="mf">115.0</span><span class="p">,</span> <span class="mf">109.0</span><span class="p">,</span> <span class="mf">92.0</span><span class="p">,</span> <span class="mf">84.0</span><span class="p">,</span> <span class="mf">81.0</span><span class="p">,</span> <span class="mf">77.0</span><span class="p">,</span> <span class="mf">67.0</span><span class="p">,</span> <span class="mf">64.0</span><span class="p">,</span> <span class="mf">61.0</span><span class="p">,</span> <span class="mf">61.0</span><span class="p">,</span> <span class="mf">54.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">46.0</span><span class="p">,</span> <span class="mf">37.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">36.0</span><span class="p">,</span> <span class="mf">38.0</span><span class="p">,</span> <span class="mf">35.0</span><span class="p">,</span> <span class="mf">31.0</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="c1">### Functions</span>

    <span class="c1"># Function to count numbers in each compartment</span>
    <span class="k">def</span> <span class="nf">count_type</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="nb">type</span><span class="p">)</span>

    <span class="c1"># Function to check the current scale</span>
    <span class="k">def</span> <span class="nf">findscale</span><span class="p">(</span><span class="n">home</span><span class="p">):</span>
        <span class="c1"># Check location</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">NOHOUSES</span> <span class="k">if</span> <span class="n">home</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">NOCLASSES</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">loc</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">icounts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">loc</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">icountss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">loc</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="n">home</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">,</span> <span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">c</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">icounts</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="n">home</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">,</span> <span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">c</span><span class="p">),</span> <span class="n">PERSON</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
               <span class="c1"># icountss[j, c] = np.count_nonzero(np.logical_and(np.logical_and(PERSON[0:200,home]==j, PERSON[0:200,3]), PERSON[0:200,4]==0))</span>
        <span class="c1"># Sum of all rates</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">OMEGA</span><span class="o">*</span><span class="n">counts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">GAMMA</span><span class="o">*</span><span class="n">counts</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">WANE</span><span class="o">*</span><span class="n">counts</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">MIX</span><span class="p">)</span><span class="o">*</span><span class="n">BETA</span><span class="p">[</span><span class="n">home</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">icounts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">icounts</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="n">MIX</span><span class="o">*</span><span class="p">(</span><span class="n">BETA</span><span class="p">[</span><span class="n">home</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">icounts</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">icounts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">scale</span>

    <span class="c1"># Main function</span>

    <span class="n">MIX</span><span class="o">=</span><span class="mf">0.0001</span><span class="o">*</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">mix_w</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">TRACING</span><span class="o">=</span><span class="p">(</span><span class="n">trace_w</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">TESTNO</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">test_w</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">CLASS</span><span class="o">=</span><span class="p">(</span><span class="n">class_w</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">ISOLATE</span><span class="o">=</span><span class="p">(</span><span class="n">isolate_w</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="n">classes</span><span class="o">=</span><span class="n">CLASS</span>
    <span class="n">NOCLASSES</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">POPSIZE</span><span class="o">/</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>

    <span class="n">peaks</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># For storing peak no. of infecteds</span>
    <span class="n">tots</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># For storing total no. infected</span>

    <span class="k">for</span> <span class="n">reps</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">REPS</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">reps</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running simulation 1&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;, </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span><span class="k">int</span>(reps+1), end=&quot; &quot;)

        <span class="n">shuff1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">POPSIZE</span><span class="p">)</span>
        <span class="n">shuff2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">POPSIZE</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shuff1</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shuff2</span><span class="p">)</span>

        <span class="n">PERSON</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">POPSIZE</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="c1"># 0th col: ID - First 200 are superspreaders</span>
        <span class="c1"># 1st col: house</span>
        <span class="c1"># 2nd col: class</span>
        <span class="c1"># 3rd col: SIR status</span>
        <span class="c1"># 4th col: Isolation status</span>
        <span class="n">infs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">POPSIZE</span><span class="p">,</span><span class="n">I0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">POPSIZE</span><span class="p">):</span>
            <span class="n">PERSON</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">infs</span><span class="p">:</span>
                <span class="n">PERSON</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># Initially everyone susceptible except I0 individuals</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NOHOUSES</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shuff1</span><span class="p">[</span><span class="n">index</span><span class="p">::</span><span class="n">NOHOUSES</span><span class="p">]:</span>
                <span class="n">PERSON</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">index</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NOCLASSES</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shuff2</span><span class="p">[</span><span class="n">index</span><span class="p">::</span><span class="n">NOCLASSES</span><span class="p">]:</span>
                <span class="n">PERSON</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">index</span>

        <span class="c1"># Some local constants / lists</span>
        <span class="n">tsteps</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">infecteds</span><span class="o">=</span><span class="p">[</span><span class="n">count_type</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
        <span class="n">susceptibles</span><span class="o">=</span><span class="p">[</span><span class="n">count_type</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
        <span class="n">exposed</span><span class="o">=</span><span class="p">[</span><span class="n">count_type</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">current_t</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">home</span><span class="o">=</span><span class="mi">2</span> <span class="c1"># Everyone starts at home</span>
        <span class="n">total_infections</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># Since immunity wanes, count every infection event</span>

        <span class="c1"># Main run</span>
        <span class="k">while</span> <span class="n">current_t</span> <span class="o">&lt;</span> <span class="n">MAX_TIME</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>

            <span class="c1"># Find proposed time to next event</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">findscale</span><span class="p">(</span><span class="n">home</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">())</span> <span class="o">/</span> <span class="n">scale</span>
            <span class="n">proposed_t</span> <span class="o">=</span> <span class="n">tsteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span>

            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">proposed_t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_t</span><span class="p">):</span> <span class="c1"># Has to come first or misses days</span>
                <span class="c1"># If new day, change isolation status and test, then start again</span>
                <span class="c1"># Update isolation status</span>
                <span class="k">for</span> <span class="n">ppl</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">POPSIZE</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">PERSON</span><span class="p">[</span><span class="n">ppl</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">PERSON</span><span class="p">[</span><span class="n">ppl</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>

                <span class="c1"># Jump is only one new day</span>
                <span class="n">current_t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_t</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

                <span class="c1"># Weekly Test</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_t</span><span class="p">)</span><span class="o">%</span><span class="k">7</span>==1:

                    <span class="c1"># Only non-isolators test</span>
                    <span class="n">findx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># Adjust test number if too many isolating</span>
                    <span class="n">testnum</span> <span class="o">=</span> <span class="n">TESTNO</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="n">TESTNO</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># Randomise list</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c1"># Isolate Exposed and Infected individuals for 10 days</span>
                    <span class="k">for</span> <span class="n">tests</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">testnum</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                            <span class="c1"># False negative / ignore rate of 5%</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.95</span><span class="p">:</span>
                                <span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">ISOLATE</span>
                                <span class="c1"># contact trace</span>
                                <span class="n">num_traced</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">TRACING</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">case_contacts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">2</span><span class="p">]))</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">case_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="c1">#print(num_traced,case_contacts[0].size)</span>
                                <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_traced</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="n">PERSON</span><span class="p">[</span><span class="n">case_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">trace</span><span class="p">],</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                        <span class="n">PERSON</span><span class="p">[</span><span class="n">case_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">trace</span><span class="p">],</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">ISOLATE</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># False positive rate of 1%</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span><span class="o">&gt;</span><span class="mf">0.99</span><span class="p">:</span>
                                <span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">ISOLATE</span>
                                <span class="c1"># contact trace</span>
                                <span class="n">num_traced</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">TRACING</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">case_contacts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">PERSON</span><span class="p">[</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">tests</span><span class="p">],</span><span class="mi">2</span><span class="p">]))</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">case_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_traced</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="n">PERSON</span><span class="p">[</span><span class="n">case_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">trace</span><span class="p">],</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                                        <span class="n">PERSON</span><span class="p">[</span><span class="n">case_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">trace</span><span class="p">],</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">ISOLATE</span>
            <span class="k">elif</span> <span class="n">home</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">proposed_t</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">proposed_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">CLASS_START</span> <span class="ow">and</span> <span class="n">proposed_t</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">proposed_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">CLASS_END</span><span class="p">:</span>
                <span class="c1"># If students are home and proposed time of next event is later</span>
                <span class="c1"># than class starts, then no event occurs before class starts</span>
                <span class="n">current_t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proposed_t</span><span class="p">)</span><span class="o">+</span><span class="n">CLASS_START</span>
                <span class="n">home</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">home</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">proposed_t</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">proposed_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">CLASS_END</span><span class="p">:</span>
                <span class="c1"># If students are in class and proposed time of next event is</span>
                <span class="c1"># later than class ends, then no event occurs before class ends</span>
                <span class="n">current_t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proposed_t</span><span class="p">)</span><span class="o">+</span><span class="n">CLASS_END</span>
                <span class="n">home</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Next event occurs before class starts/ends</span>
                <span class="n">current_t</span> <span class="o">=</span> <span class="n">proposed_t</span>

                <span class="c1"># Find event</span>
                <span class="n">eventcheck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">()</span>
                <span class="c1"># Need to find non-isolating infecteds, superspreaders and susceptibles</span>
                <span class="c1">#countSS=np.count_nonzero(np.logical_and(PERSON[:,3]==2, PERSON[:,4]==0))</span>
                <span class="n">countNSS</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="n">PERSON</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">countsus</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">PERSON</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">eventcheck</span> <span class="o">&lt;</span> <span class="n">GAMMA</span><span class="o">*</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">:</span> <span class="c1">#Event is recovery</span>

                    <span class="c1"># If there are any infected people, randomly choose one to recover</span>
                    <span class="n">infected_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">infected_indices</span><span class="p">:</span>
                        <span class="n">PERSON</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">infected_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>

                <span class="k">elif</span> <span class="n">eventcheck</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">OMEGA</span><span class="o">*</span><span class="n">exposed</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">scale</span><span class="p">:</span> <span class="c1"># Event is latent-&gt;infected</span>

                    <span class="c1"># If there are any latents, randomly choose one to become infected</span>
                    <span class="n">latent_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">latent_indices</span><span class="p">:</span>
                        <span class="n">PERSON</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">latent_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

                <span class="k">elif</span> <span class="n">eventcheck</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">OMEGA</span><span class="o">*</span><span class="n">exposed</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">WANE</span><span class="o">*</span><span class="n">count_type</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="n">scale</span><span class="p">:</span>
                    <span class="c1"># Event is waned immunity</span>
                    <span class="c1"># If there are any immunes, randomly choose one to become susceptible</span>
                    <span class="n">immune_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">immune_indices</span><span class="p">:</span>
                        <span class="n">PERSON</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">immune_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">elif</span> <span class="n">eventcheck</span> <span class="o">&lt;</span><span class="p">(</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">OMEGA</span><span class="o">*</span><span class="n">exposed</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">WANE</span><span class="o">*</span><span class="n">count_type</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">MIX</span><span class="o">*</span><span class="p">(</span><span class="n">BETA</span><span class="p">[</span><span class="n">home</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">countNSS</span><span class="p">)</span><span class="o">*</span><span class="n">countsus</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">:</span>

                    <span class="c1"># Event is mixed transmission</span>

                    <span class="n">sus_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">sus_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">PERSON</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">sus_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">total_infections</span><span class="o">+=</span><span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span> <span class="c1">#Event is Transmission by househould contact</span>
                    <span class="n">findx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span> <span class="c1"># Find susceptible hosts who are not isolating</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># randomly shuffle</span>
                    <span class="k">for</span> <span class="n">tryx</span> <span class="ow">in</span> <span class="n">findx</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">PERSON</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="n">home</span><span class="p">]</span>
                        <span class="n">contacts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">PERSON</span><span class="p">[:,</span><span class="n">home</span><span class="p">]</span><span class="o">==</span><span class="n">loc</span><span class="p">,</span> <span class="n">PERSON</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">),</span> <span class="n">PERSON</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
                        <span class="c1">#contacts=np.where(PERSON[:,home]==loc)</span>

                        <span class="k">if</span> <span class="n">contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">PERSON</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                            <span class="n">total_infections</span><span class="o">+=</span><span class="mi">1</span>
                            <span class="k">break</span>

            <span class="c1"># Update lists</span>
            <span class="n">tsteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_t</span><span class="p">)</span>
            <span class="n">infecteds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">exposed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">susceptibles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

            <span class="c1"># Stop if infections has finished</span>
            <span class="k">if</span> <span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;</span> <span class="n">exposed</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">tsteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MAX_TIME</span><span class="p">)</span>
                <span class="n">infecteds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">exposed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">susceptibles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">break</span>

       <span class="c1"># print(count_type(0), count_type(1), count_type(2), count_type(3))</span>

        <span class="c1"># Find peak no. infected</span>
        <span class="n">peaks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">infecteds</span><span class="p">)</span><span class="o">/</span><span class="n">POPSIZE</span><span class="p">)</span>
        <span class="n">tots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_infections</span><span class="o">+</span><span class="n">I0</span><span class="p">)</span>
        <span class="n">infplot</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">infecteds</span><span class="p">)):</span>
            <span class="n">infplot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infecteds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reps</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span><span class="n">infplot</span><span class="p">,</span><span class="s1">&#39;b:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Interventions&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span><span class="n">infplot</span><span class="p">,</span><span class="s1">&#39;b:&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">solstore</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;r:&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Default&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">solstore</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;r:&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;% Infected&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The mean peak infected was reduced from 18% to&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">),</span> <span class="s2">&quot;%.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The mean total infected was reduced from 96% to&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tots</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="s2">&quot;%.&quot;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">test_w</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">isolate_w</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">trace_w</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">mix_w</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">class_w</span><span class="p">)</span>
<span class="n">interact_manual</span><span class="p">(</span><span class="n">runmodel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "626a0db0d1304e10a917bdc60ae6e424"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "e79c6216acdd4a5fae2cf7c6a33713ff"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "fa2ff94e41a749e797e17b19af888d8f"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "272f18605c7d42d6bc681c34a207b44c"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "c3efc149e2cf434c994f4847d462cde0"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "ff7deb59c04148448d6535881fa9b34a"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;function __main__.runmodel()&gt;
</pre></div>
</div>
</div>
</div>
<p><strong>Some talking points</strong></p>
<p>You should find that the two interventions with the biggest efefcts are testing and mixing reduction. It is interesting (I think!) that even with just a 3 day isolation period, having 50% or more of the populaiton test can make a big impact on reducing the epidemic. Reducing the class size has a somewhat lesser effect, and changing the isolation period and number of contacts traced makes very little difference at all. It is reasonably easy to find combinations of moderate amounts of each control - and so would not be too disruptive - that can more or less prevent an epidemic occurring.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="a-bit-extra-in-case-we-still-have-time">
<h1>5 - A bit extra in case we still have time…<a class="headerlink" href="#a-bit-extra-in-case-we-still-have-time" title="Permalink to this heading">#</a></h1>
<p>This section of code is for a model I worked on with an undergraduate student during a summer research project, which eventually got published in a leading academic journal for mathematical biology.</p>
<p>The models we have looked at so far assume the infection spreads ‘globally’ - that is, as a suceptible individual you are equally likely to catch the infection off any infected individual. In reality, you are much more likely to catch the disease off somebody physically close to you. The previous model captures this a bit with the household structure. Another simple way of modelling this is to assume the population lives on a square lattice. An individual’s contacts could then be <em>either</em> global across the lattice <em>or</em> local with its 4 near-neighbours, or a mix of the two.</p>
<p>This code introduces a parameter <span class="math notranslate nohighlight">\(L\)</span> to control the degree of local interactions. <span class="math notranslate nohighlight">\(L=0\)</span> means all contacts are global, <span class="math notranslate nohighlight">\(L=1\)</span> means all contacts are local, and <span class="math notranslate nohighlight">\(0&lt;L&lt;1\)</span> means a weigthed mix of the two.</p>
<p>We present this model in 3 different ways:</p>
<ol class="arabic simple">
<li><p>The standard ODE model that does not include any structure.</p></li>
<li><p>An approximate ODE model using a ‘pair approximation’ to include some structure.</p></li>
<li><p>10 runs of a stochastic model that is fully spatially structured.</p></li>
</ol>
<p><em>This can take a few seconds to run.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>
<span class="c1"># Import the necessary libraries</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact_manual</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

<span class="n">Lw</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>

<span class="n">gridsaves</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">36</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
<span class="n">num_frames</span><span class="o">=</span><span class="mi">0</span>

<span class="k">def</span> <span class="nf">runspatial</span><span class="p">():</span>
  <span class="n">N</span><span class="o">=</span><span class="mi">20</span>                     <span class="c1"># Grid size (suggested min. of 20 and max. of 50 - the larger, the longer it takes)</span>
  <span class="n">tot</span><span class="o">=</span><span class="n">N</span><span class="o">*</span><span class="n">N</span>
  <span class="n">GAMMA</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">14</span>               <span class="c1"># Recovery rate</span>
  <span class="n">R0</span><span class="o">=</span><span class="mf">2.5</span>                   <span class="c1"># R_0</span>
  <span class="n">BETA</span><span class="o">=</span><span class="n">R0</span><span class="o">*</span><span class="n">GAMMA</span><span class="o">/</span><span class="n">tot</span>        <span class="c1"># Transmission</span>
  <span class="n">I0</span><span class="o">=</span><span class="mi">5</span>                     <span class="c1"># Starting no. of infecteds</span>
  <span class="n">REPS</span><span class="o">=</span><span class="mi">10</span>                  <span class="c1"># No. of replicates of IBM to do</span>
  <span class="n">L</span><span class="o">=</span><span class="n">Lw</span><span class="o">.</span><span class="n">value</span>

  <span class="c1"># PAIR APPROXIMATION</span>
  <span class="k">def</span> <span class="nf">pairs</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">BETAP</span><span class="p">):</span>
      <span class="n">qis</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">sdot</span><span class="o">=-</span><span class="n">BETAP</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">qis</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">idot</span><span class="o">=</span><span class="n">BETAP</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">qis</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">ssdot</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="n">BETAP</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">qis</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">sidot</span><span class="o">=-</span><span class="n">BETAP</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">qis</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">BETAP</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">qis</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">srdot</span><span class="o">=-</span><span class="n">BETAP</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">qis</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">iidot</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">BETAP</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">qis</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="n">irdot</span><span class="o">=-</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="n">BETAP</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="o">*</span><span class="n">qis</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
      <span class="k">return</span> <span class="p">[</span><span class="n">sdot</span><span class="p">,</span><span class="n">idot</span><span class="p">,</span><span class="n">ssdot</span><span class="p">,</span><span class="n">sidot</span><span class="p">,</span><span class="n">srdot</span><span class="p">,</span><span class="n">iidot</span><span class="p">,</span><span class="n">irdot</span><span class="p">]</span>

  <span class="c1"># MEAN-FIELD APPROXIMATION</span>
  <span class="k">def</span> <span class="nf">disease</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">BETAP</span><span class="p">):</span>
      <span class="n">sdot</span><span class="o">=-</span><span class="n">BETAP</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">idot</span><span class="o">=</span><span class="n">BETAP</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">return</span> <span class="n">sdot</span><span class="p">,</span> <span class="n">idot</span>

  <span class="c1"># Function to count noumbers in each compartment</span>
  <span class="k">def</span> <span class="nf">count_type</span><span class="p">(</span><span class="n">sirtype</span><span class="p">):</span>
      <span class="n">current_type</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
              <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="n">sirtype</span><span class="p">:</span>
                  <span class="n">current_type</span><span class="o">=</span><span class="n">current_type</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">return</span> <span class="n">current_type</span>

  <span class="c1"># Function to find nearest-neighbours</span>
  <span class="k">def</span> <span class="nf">local_inf</span><span class="p">(</span><span class="n">site_x</span><span class="p">,</span><span class="n">site_y</span><span class="p">):</span>
      <span class="n">localinfs</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">if</span> <span class="n">site_x</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">downx</span><span class="o">=</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">downx</span><span class="o">=</span><span class="n">site_x</span><span class="o">-</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">site_y</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">downy</span><span class="o">=</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">downy</span><span class="o">=</span><span class="n">site_y</span><span class="o">-</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">site_x</span><span class="o">==</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">upx</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">upx</span><span class="o">=</span><span class="n">site_x</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">site_y</span><span class="o">==</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">upy</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">upy</span><span class="o">=</span><span class="n">site_y</span><span class="o">+</span><span class="mi">1</span>

      <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">downx</span><span class="p">,</span><span class="n">site_y</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">localinfs</span><span class="o">=</span><span class="n">localinfs</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">upx</span><span class="p">,</span><span class="n">site_y</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">localinfs</span><span class="o">=</span><span class="n">localinfs</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">site_x</span><span class="p">,</span><span class="n">downy</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">localinfs</span><span class="o">=</span><span class="n">localinfs</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">site_x</span><span class="p">,</span><span class="n">upy</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">localinfs</span><span class="o">=</span><span class="n">localinfs</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">return</span> <span class="n">localinfs</span>

  <span class="c1"># Function to check the current scale</span>
  <span class="k">def</span> <span class="nf">findscale</span><span class="p">():</span>
      <span class="n">S</span><span class="o">=</span><span class="n">count_type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">I</span><span class="o">=</span><span class="n">count_type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">localinf</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
              <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                  <span class="n">localinf</span><span class="o">=</span><span class="n">local_inf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">localinf</span>
      <span class="k">if</span> <span class="n">S</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">QIS</span><span class="o">=</span><span class="n">localinf</span><span class="o">/</span><span class="n">S</span><span class="o">*</span><span class="n">tot</span><span class="o">/</span><span class="mi">4</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">QIS</span><span class="o">=</span><span class="mi">0</span>
      <span class="c1">#Set relative parameter values</span>
      <span class="n">scale</span><span class="o">=</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">I</span><span class="o">+</span><span class="n">BETA</span><span class="o">*</span><span class="n">S</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">QIS</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">L</span><span class="p">)</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">scale</span>

  <span class="c1">#saves up to 500 plots for animation</span>
  <span class="k">global</span> <span class="n">gridsaves</span>
  <span class="n">sus</span><span class="p">,</span><span class="n">inf</span><span class="p">,</span><span class="n">rec</span><span class="p">,</span><span class="n">tplot</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
  <span class="k">global</span> <span class="n">num_frames</span>

  <span class="n">gridsaves</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">90</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
  <span class="n">num_frames</span><span class="o">=</span><span class="mi">0</span>


  <span class="n">ibmmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">REPS</span><span class="p">)</span>
  <span class="n">ibmt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">REPS</span><span class="p">)</span>

  <span class="c1"># Multiple runs of model</span>
  <span class="k">for</span> <span class="n">reps</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">REPS</span><span class="p">):</span>
      <span class="n">plots</span><span class="o">=-</span><span class="mi">1</span>
      <span class="c1"># Set initial conditions</span>
      <span class="n">init_inf</span><span class="o">=</span><span class="n">I0</span>
      <span class="n">grid</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">init_inf</span><span class="p">):</span>
          <span class="n">grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span><span class="o">=</span><span class="mi">1</span>
      <span class="n">tsteps</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">infecteds</span><span class="o">=</span><span class="p">[</span><span class="n">count_type</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
      <span class="n">current_t</span><span class="o">=</span><span class="mi">0</span>

      <span class="c1"># Main run</span>
      <span class="k">while</span> <span class="n">current_t</span><span class="o">&lt;</span><span class="mi">180</span><span class="p">:</span>

          <span class="c1"># Find tau-leap</span>
          <span class="n">scale</span><span class="o">=</span><span class="n">findscale</span><span class="p">()</span>
          <span class="n">dt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span> <span class="o">/</span> <span class="n">scale</span>
          <span class="n">current_t</span><span class="o">=</span><span class="n">tsteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

          <span class="c1">#saves a grid every 2 days</span>
          <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">90</span><span class="p">):</span>
              <span class="k">if</span> <span class="n">reps</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">current_t</span><span class="o">&lt;</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">current_t</span><span class="o">+</span><span class="n">dt</span><span class="o">&gt;</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="p">:</span>
                  <span class="n">gridsaves</span><span class="p">[</span><span class="n">num_frames</span><span class="p">][:][:]</span><span class="o">=</span><span class="n">grid</span><span class="p">[:][:]</span>
                  <span class="n">num_frames</span> <span class="o">+=</span><span class="mi">1</span>
                  <span class="n">sus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">))</span>
                  <span class="n">inf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">))</span>
                  <span class="n">rec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="p">))</span>
                  <span class="n">tplot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">+</span><span class="n">current_t</span><span class="p">)</span>

          <span class="c1"># Create randomised list of sites to check</span>
          <span class="n">findx</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
          <span class="n">findy</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
          <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">findx</span><span class="p">)</span>
          <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">findy</span><span class="p">)</span>
          <span class="n">flagged</span><span class="o">=</span><span class="mi">0</span>   <span class="c1"># Used to break out of 2nd loop</span>

          <span class="c1">#Find event</span>
          <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">&lt;</span><span class="n">GAMMA</span><span class="o">*</span><span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">scale</span><span class="p">:</span> <span class="c1">#Event is recovery</span>
              <span class="k">for</span> <span class="n">tryx</span> <span class="ow">in</span> <span class="n">findx</span><span class="p">:</span>
                  <span class="k">if</span> <span class="n">flagged</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                      <span class="k">break</span>
                  <span class="k">for</span> <span class="n">tryy</span> <span class="ow">in</span> <span class="n">findy</span><span class="p">:</span>
                      <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="n">tryy</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                          <span class="n">grid</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="n">tryy</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
                          <span class="n">flagged</span><span class="o">=</span><span class="mi">1</span>
                          <span class="k">break</span>
          <span class="k">else</span><span class="p">:</span> <span class="c1">#Event is transmission</span>
              <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">&gt;</span><span class="n">L</span><span class="p">:</span> <span class="c1">#Transmission is global</span>
                  <span class="k">for</span> <span class="n">tryx</span> <span class="ow">in</span> <span class="n">findx</span><span class="p">:</span>
                      <span class="k">if</span> <span class="n">flagged</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                          <span class="k">break</span>
                      <span class="k">for</span> <span class="n">tryy</span> <span class="ow">in</span> <span class="n">findy</span><span class="p">:</span>
                          <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="n">tryy</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                              <span class="n">grid</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="n">tryy</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                              <span class="n">flagged</span><span class="o">=</span><span class="mi">1</span>
                              <span class="k">break</span>
              <span class="k">else</span><span class="p">:</span> <span class="c1"># Transmission is local</span>
                  <span class="k">for</span> <span class="n">tryx</span> <span class="ow">in</span> <span class="n">findx</span><span class="p">:</span>
                      <span class="k">if</span> <span class="n">flagged</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                          <span class="k">break</span>
                      <span class="k">for</span> <span class="n">tryy</span> <span class="ow">in</span> <span class="n">findy</span><span class="p">:</span>
                          <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="n">tryy</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                              <span class="k">if</span> <span class="n">local_inf</span><span class="p">(</span><span class="n">tryx</span><span class="p">,</span><span class="n">tryy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                                  <span class="n">grid</span><span class="p">[</span><span class="n">tryx</span><span class="p">,</span><span class="n">tryy</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                                  <span class="n">flagged</span><span class="o">=</span><span class="mi">1</span>
                                  <span class="k">break</span>

          <span class="c1"># Update time and infection lists</span>
          <span class="n">tsteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">+</span><span class="n">current_t</span><span class="p">)</span>
          <span class="n">infecteds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count_type</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
          <span class="k">if</span> <span class="n">infecteds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
              <span class="k">break</span>

      <span class="c1"># Plot latest run</span>
      <span class="n">infected_prop</span><span class="o">=</span><span class="p">[</span><span class="n">inf</span><span class="o">/</span><span class="n">tot</span> <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="n">infecteds</span><span class="p">]</span>
      <span class="n">ibmmax</span><span class="p">[</span><span class="n">reps</span><span class="p">]</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">infected_prop</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">tsteps</span><span class="p">)):</span>
          <span class="k">if</span> <span class="n">infected_prop</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="n">ibmmax</span><span class="p">[</span><span class="n">reps</span><span class="p">]:</span>
              <span class="n">ibmt</span><span class="p">[</span><span class="n">reps</span><span class="p">]</span><span class="o">=</span><span class="n">tsteps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
              <span class="k">break</span>
      <span class="k">if</span> <span class="n">reps</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span><span class="n">infected_prop</span><span class="p">,</span><span class="s1">&#39;b:&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stochastic model&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsteps</span><span class="p">,</span><span class="n">infected_prop</span><span class="p">,</span><span class="s1">&#39;b:&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>



  <span class="n">ETA</span><span class="o">=</span><span class="n">R0</span><span class="o">*</span><span class="n">GAMMA</span> <span class="c1"># In ODE models total pop=1 so beta needs changing</span>
  <span class="n">ts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>
  <span class="n">xx1</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">disease</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="mi">1</span><span class="o">-</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">,</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">],</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ETA</span><span class="p">,),</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx1</span><span class="o">.</span><span class="n">t</span><span class="p">,(</span><span class="n">xx1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean-field&#39;</span><span class="p">)</span>



  <span class="n">ts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>
  <span class="n">xxp</span><span class="o">=</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">pairs</span><span class="p">,[</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="mi">1</span><span class="o">-</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">,</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,(</span><span class="mi">1</span><span class="o">-</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">),</span><span class="mi">0</span><span class="p">,(</span><span class="n">I0</span><span class="o">/</span><span class="n">tot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ETA</span><span class="p">,),</span><span class="n">t_eval</span><span class="o">=</span><span class="n">ts</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xxp</span><span class="o">.</span><span class="n">t</span><span class="p">,(</span><span class="n">xxp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spatial approx.&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion Infected&#39;</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
  <span class="c1">#plt.savefig(&#39;l09.png&#39;)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;By day 180,&#39;</span><span class="p">,</span> <span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="mi">100</span><span class="o">*</span><span class="n">xxp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;per-cent of the population have been infected.&#39;</span><span class="p">)</span>
  <span class="k">return</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">Lw</span><span class="p">)</span>
<span class="n">my_interact_manual4</span> <span class="o">=</span> <span class="n">interact_manual</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">manual_name</span><span class="o">=</span><span class="s2">&quot;Run model&quot;</span><span class="p">)</span>
<span class="n">my_interact_manual4</span><span class="p">(</span><span class="n">runspatial</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "5ae892ed1ae14417a2d73697d3a4a4a2"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "b1bb7ed0c51c4a94a1578a747fcc2fdb"}</script></div>
</div>
<p><strong>Animation</strong></p>
<p>The cell below will show an animation of the above model, showing how the disease spreads through the lattice for one of the stochastic model runs calculated above. You should see that when L is small the infection quickly spreads across the lattice with long-distance transmission occuringly regularly. When L is large, however, you should instead see that the infection spreads predominantly through local contacts, slowing the epidemic down.</p>
<p>Each time you choose a different L value and click ‘Run Interact’ in the cell above, before running this code.</p>
<p><em>Again, this may take a few moments to run.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>
<span class="c1">#animations for the lattice for the IBM</span>

<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">clt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span><span class="p">,</span> <span class="n">rc</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">N</span><span class="o">=</span><span class="mi">20</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="c1"># make color map</span>
    <span class="n">my_cmap</span> <span class="o">=</span> <span class="n">clt</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
    <span class="c1"># set the &#39;bad&#39; values (nan) to be white and transparent</span>
    <span class="n">my_cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="c1"># draw the boxes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gridsaves</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">my_cmap</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#legend</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Susceptible&#39;</span><span class="p">,</span><span class="s1">&#39;Infected&#39;</span><span class="p">,</span><span class="s1">&#39;Recovered&#39;</span><span class="p">]</span>
    <span class="n">pat</span> <span class="o">=</span> <span class="p">[</span> <span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{l}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">))</span> <span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">pat</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.</span> <span class="p">)</span>
    <span class="c1">#title and axis</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Simulation of infections&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span> <span class="c1">#needs to be closed or it just prints a stationairy frame</span>
<span class="c1">#animator - change repeat to false to make video stop at the end</span>
<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">frames</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_frames</span><span class="p">),</span><span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#HTML function for Jupyter</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_html5_video</span><span class="p">())</span>
<span class="c1">#anim.save(&#39;local0.mp4&#39;)</span>

<span class="c1"># The above code requires ffmpeg to be installed</span>
<span class="c1"># I found that you can still produce the animation by commenting out &#39;plt.close(fig)&#39; and replacing HTML(anim.to_html5_video()) with plt.show(anim)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">34</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">frames</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">num_frames</span><span class="p">),</span><span class="n">repeat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="c1">#HTML function for Jupyter</span>
<span class="ne">---&gt; </span><span class="mi">34</span> <span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_html5_video</span><span class="p">())</span>

<span class="nn">File ~\AppData\Local\anaconda3\Lib\site-packages\matplotlib\animation.py:1284,</span> in <span class="ni">Animation.to_html5_video</span><span class="nt">(self, embed_limit)</span>
<span class="g g-Whitespace">   </span><span class="mi">1281</span> <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;temp.m4v&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1282</span> <span class="c1"># We create a writer manually so that we can get the</span>
<span class="g g-Whitespace">   </span><span class="mi">1283</span> <span class="c1"># appropriate size for the tag</span>
<span class="ne">-&gt; </span><span class="mi">1284</span> <span class="n">Writer</span> <span class="o">=</span> <span class="n">writers</span><span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;animation.writer&#39;</span><span class="p">]]</span>
<span class="g g-Whitespace">   </span><span class="mi">1285</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">Writer</span><span class="p">(</span><span class="n">codec</span><span class="o">=</span><span class="s1">&#39;h264&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1286</span>                 <span class="n">bitrate</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;animation.bitrate&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">   </span><span class="mi">1287</span>                 <span class="n">fps</span><span class="o">=</span><span class="mf">1000.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1288</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">writer</span><span class="o">=</span><span class="n">writer</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\anaconda3\Lib\site-packages\matplotlib\animation.py:148,</span> in <span class="ni">MovieWriterRegistry.__getitem__</span><span class="nt">(self, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_available</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_registered</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">148</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requested MovieWriter (</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">) not available&quot;</span><span class="p">)</span>

<span class="ne">RuntimeError</span>: Requested MovieWriter (ffmpeg) not available
</pre></div>
</div>
</div>
</div>
<section id="what-does-this-tell-us">
<h2>What does this tell us?<a class="headerlink" href="#what-does-this-tell-us" title="Permalink to this heading">#</a></h2>
<p>If you look at time-courses for a high value of <span class="math notranslate nohighlight">\(L\)</span> (mainly local interactions), you will see that the epidemic is much flatter and smaller than if you choose a low value of <span class="math notranslate nohighlight">\(L\)</span> (mainly global interactions). However, this reduction in epidemic severity does not happen steadily/gradually. Even a value of <span class="math notranslate nohighlight">\(L\)</span> of <span class="math notranslate nohighlight">\(0.4\)</span> or <span class="math notranslate nohighlight">\(0.5\)</span> produces pretty similar epidemics to if there were no local interactions at all. You have to have a pretty high proportion of local interactions, often <span class="math notranslate nohighlight">\(L&gt;0.8\)</span>, to see a large effect of movement restrictions.</p>
<p>You can see why this is from the animation. When <span class="math notranslate nohighlight">\(L\)</span> is large, the majority of infections occur locally. Once an individual has infected all their neighbours, they run out of susceptible contacts and the local epidemic slows down. In contrast, when <span class="math notranslate nohighlight">\(L\)</span> is small so that infected individuals frequently have global contacts, the infection can easily spread to a new area of the grid and start a new local epidemic.</p>
<p>Another thing to notice is the variation in the time-courses for the stochastic model runs. This is especially evident at low values of <span class="math notranslate nohighlight">\(R_0\)</span> and mid-to-high values of <span class="math notranslate nohighlight">\(L\)</span>, where the peak and total number infected can vary widely for the exact same system and parameters.</p>
<p>For more details, please read the <a class="reference external" href="https://link.springer.com/article/10.1007%2Fs11538-021-00961-w">publication</a> by me and Lydia.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="ch9.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">9 - A within-host Covid model <a name="chapter8"></a></p>
      </div>
    </a>
    <a class="right-next"
       href="ch11.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">11-12 Project Week</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Topics in Mathematical Biology</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computer-lab-1">Computer lab 1</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-started">Getting started</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#a-first-epidemic-model">1 - A first epidemic model#</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-best-control-an-epidemic">2 - How to best control an epidemic</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#control-with-different-risk-groups">3 - Control with different risk groups</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#including-randomness-in-our-model">3: Including randomness in our model#</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#a-bit-extra-in-case-we-still-have-time">5 - A bit extra in case we still have time…</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-does-this-tell-us">What does this tell us?</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alex Best
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>